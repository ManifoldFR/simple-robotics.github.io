<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description" content="Differentiable QP Solver">
  <meta name="keywords" content="Augmented Lagrangian, Quadratic Programming, Machine Learning, Optimization Layers, Differentiable Optimization">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>QPLayer</title>

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <link rel="icon" href="./static/images/favicon.svg">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>
</head>
<body>

<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start" style="flex-grow: 1; justify-content: center;">
      <a class="navbar-item" href="https://simple-robotics.github.io">
        <span class="icon">
          <i class="fas fa-home"></i>
        </span>
      </a>

  </div>
</nav>

<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title">Leveraging Augmented-Lagrangian Techniques for Differentiating Over Infeasible Quadratic Programs in Machine Learning</h1>
          <div class="is-size-5 publication-authors">
            <span class="author-block">
              <a href="https://bambade.github.io">Antoine Bambade</a><sup>*</sup>,</span>
            <span class="author-block">
              <a href="https://fabinsch.github.io/">Fabian Schramm</a>,</span>
            <span class="author-block">
              <a href="https://adrientaylor.github.io">Adrien Taylor</a>,</span>
            <span class="author-block">
              <a href="https://jcarpent.github.io">Justin Carpentier</a></span>
          </div>

          <div class="is-size-5 publication-authors">
            <span class="author-block"><sup>*</sup>Inria - Département d’Informatique de l'École normale supérieure, PSL Research University, France.</span>
          </div>

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- PDF Link. -->
              <span class="link-block">
                <a href="./static/paper/qplayer.pdf"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                  </span>
                  <span>Paper</span>
                </a>
              </span>
              <span class="link-block">
                <a href="https://hal.science/hal-04133055"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                    <i class="fas fa-globe-europe"></i>
                  </span>
                  <span>HAL</span>
                </a>
              </span>

              <!-- Code Link. -->
              <span class="link-block">
                <a href="https://github.com/simple-robotics/proxsuite"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Code</span>
                </a>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop">
    <!-- Abstract. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          Optimization layers within neural network architectures have become increasingly popular for their ability to solve a wide range of machine learning tasks and to model domain-specific knowledge. However, designing optimization layers requires careful consideration as the underlying optimization problems might be infeasible during training. Motivated by applications in learning, control and robotics, this work focuses on convex quadratic programming (QP) layers. The specific structure of this type of optimization layer can be efficiently exploited for faster computations while still allowing rich modeling capabilities. We leverage primal-dual augmented Lagrangian techniques for computing derivatives of both feasible and infeasible QP solutions. More precisely, we propose a unified approach that tackles the differentiability of the closest feasible QP solutions in a classical ℓ2 sense. We then harness this approach to enrich the expressive capabilities of existing QP layers. More precisely, we show how differentiating through infeasible QPs during training enables to drive towards feasibility at test time a new range of QP layers. These layers notably demonstrate superior predictive performance in some conventional learning tasks. Additionally, we present alternative formulations that enhance numerical robustness, speed, and accuracy for training such layers. Along with these contributions, we provide an open-source C++ software package called QPLayer for differentiating feasible and infeasible convex QPs and which can be interfaced with modern learning frameworks.

        <div class="publication-image">
            <img src="./static/images/qplayer-model.png" alt="QPLayer" style="width:100%">
        </div>

        </div>
      </div>
    </div>
    <!--/ Abstract. -->

    <!-- Results. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-max-desktop">
        <h2 class="title is-3">Results</h2>
        <div class="content">
          <p>
            Our backward mode differentiation of convex QP layers has been implemented in C++. We refer to
            it as QPLayer in what follows. Our code leverages the primal-dual augmented Lagrangian solver
            ProxQP (Bambade et al., 2022), also written in C++ as its internal QP solver. This section illustrates
            through a classic Sudoku learning task that QPLayer allows relaxing primal feasibility constraints,
            thereby enabling the training of simplified layers.
          </p>
        </div>
        <div class="columns is-centered">
          <div class="column">
            <div class="content">
              <img src="./static/images/dl-optlayer.png" alt="Sudoku Plot" style="width:100%">
              <p>Figure 1: Deep learning paradigm for Sudoku solving task.</p>
            </div>
          </div>
        </div>
        <div class="columns is-centered">
          <div class="column">
            <div class="content">
              <img src="./static/images/loss-plot.png" alt="Loss Plot" style="width:100%">
              <p>Figure 2: Test MSE loss of QPLayer, OptNet, QPLayer-learn A, and OptNet-learn A specialized for learning A. It includes Sudoku Ax = 1 violation.</p>
            </div>
          </div>
        </div>
        <div class="columns is-centered">
          <div class="column">
            <div class="content">
              <img src="./static/images/err-plot.png" alt="Error Plot" style="width:100%">
              <p>Figure 3: Test prediction errors over 1000 puzzles of OptNet, QPLayer, QPLayer-learn A and OptNet-learn A specialized for learning A.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--/ Results. -->
</section>


<section class="section">
  <div class="container is-max-desktop">

    <!-- Concurrent Work. -->
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title is-3">Related Links</h2>

        <div class="content has-text-justified">
          This work relies on <a
          href="https://github.com/simple-robotics/proxsuite">Proxsuite</a> and has been integrated as PyTorch Module with Proxsuite.
        </div>
        <div class="publication-image">
            <p>Here is a code example showing how to easily use QPLayer in PyTorch:</p>
            <img src="./static/images/code-example.png" alt="QPLayer" style="width:100%">
        </div>

      </div>
    </div>
    <!--/ Concurrent Work. -->

  </div>
</section>


<section class="section" id="BibTeX">
  <div class="container is-max-desktop content">
    <h2 class="title">BibTeX</h2>
    <pre><code>@article{bambade2024augmented,
        author    = {Bambade, Antoine and Schramm, Fabian and Taylor, Adrien and Carpentier, Justin},
        title     = {Leveraging Augmented-Lagrangian Techniques for Differentiating Over Infeasible Quadratic Programs in Machine Learning},
        journal   = {Twelfth International Conference on Learning Representations (ICLR)},
        year      = {2024},
}</code></pre>
  </div>
</section>

<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <a class="icon-link" href="./static/paper/qplayer.pdf">
        <i class="fas fa-file-pdf"></i>
      </a>
      <a class="icon-link" href="https://github.com/simple-robotics/proxsuite" class="external-link" disabled>
        <i class="fab fa-github"></i>
      </a>
    </div>
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p>
            This website is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>
          <p>
            We thank <a href="https://github.com/nerfies/nerfies.github.io">Nerfies</a> for creating the template of this webpage. You are free to borrow the <a href="https://github.com/simple-robotics.github.io/publications/simple-gradients">source code</a>, we just ask that you link back to the <a href="https://github.com/nerfies/nerfies.github.io">Nerfies</a> page in the footer.
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

</body>
</html>
